{"componentChunkName":"component---src-templates-learn-chapter-js-content-file-path-home-runner-work-layer-5-layer-5-content-learn-mastering-service-meshes-for-developers-introduction-to-service-meshes-linkerd-traffic-splitting-mdx","path":"/learn/learning-paths/mastering-service-meshes-for-developers/introduction-to-service-meshes/linkerd/traffic-splitting.html.html","result":{"data":{"chapter":{"body":"\n\nimport ControlPlane from \"../../../../src/assets/images/learn-layer5/linkerd/control-plane-c.webp\";\n\n<ChapterStyle>\n\n<h2 className=\"chapter-sub-heading\">How Linkerd handles traffic splitting</h2>\n\n<a href={ControlPlane}>\n  <img src={ControlPlane} width=\"100%\" align=\"center\" />\n</a>\n\nThe destination component of the control plane looks for changes in configuration of linkerd (actualized as Kubernetes Custom Resource Definitions) and afterward pushes the right config for\n\nproxies to follow. As opposed to presenting its own configuration format for traffic splitting, Linkerd follows the [SMI spec](https://smi-spec.io/), which plans to give a brought together, summed up setup model for service meshes (simply like ingress, CRI, and so on in Kubernetes).\n\n<h2 className=\"chapter-sub-heading\"> Deploying sample application</h2>\n\nWe will be deploying [istio's bookinfo application](https://istio.io/latest/docs/examples/bookinfo/) for this part of the demo\n\nUse meshery to deploy the bookinfo application :\n\n- In Meshery, navigate to the Linkerd adapter's management page from the left nav menu.\n- On the Linkerd adapter's management page, please enter `default` in the `Namespace` field.\n- Then, click the (+) icon on the `Sample Application` card and select `Bookinfo Application` from the list.\n\nOR...\n\n- Download the [./sample/bookinfo.yaml](https://raw.githubusercontent.com/layer5io/linkerd-service-mesh-workshop/master/lab-7/sample/book-info.yaml)\n- Inject linkerd into the sample application.\n\n```sh\nlinkerd inject ./sample/bookinfo.yaml | kubectl apply -f -\n```\n\nThis will give you the if the Linkerd injection was successful or not.\n\n```sh\nlinkerd stat deploy\n```\n\nYou will see the following services running in your cluster\n\n```sh\n kubectl get svc\n    NAME          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE\n    details       ClusterIP   10.96.115.62    <none>        9080/TCP   13m\n    kubernetes    ClusterIP   10.96.0.1       <none>        443/TCP    7h56m\n    productpage   ClusterIP   10.109.31.20    <none>        9080/TCP   13m\n    ratings       ClusterIP   10.101.57.168   <none>        9080/TCP   13m\n    reviews       ClusterIP   10.105.52.139   <none>        9080/TCP   13m\n```\n\nYou can access the producpage by port-forwarding\n\n```sh\n    kubectl port-forward svc/productpage 9080:9080\n```\n\nChecking localhost:9080 would show you a product page, with a list of reviews on the right. Those reviews are being loaded from the reviews service which is backed by the 3 reviews pods. The requests to the reviews service are randomly sent to one of the 3 review pods, as they represent different versions of this service.\n\nThe three different versions provide different output:\n\n- v1 with No stars\n- v2 with Orange stars\n- v3 with Black stars\n\nWe will have reviews service only split traffic between v1 and v2 of the application.\n\nIn Linkerd’s approach to traffic splitting, services are used as the core primitives. Hence we need to create two new services corresponding to v1 & v2 pods.\n\n```sh\nkubectl apply -f ./sample/service.yaml\n```\n\nThere are two new services created\n\n```sh\n  kubectl get svc\n    NAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE\n    details       ClusterIP   10.96.115.62     <none>        9080/TCP   35m\n    kubernetes    ClusterIP   10.96.0.1        <none>        443/TCP    8h\n    productpage   ClusterIP   10.109.31.20     <none>        9080/TCP   35m\n    ratings       ClusterIP   10.101.57.168    <none>        9080/TCP   35m\n    reviews       ClusterIP   10.105.52.139    <none>        9080/TCP   35m\n    reviews-v2    ClusterIP   10.106.174.219   <none>        9080/TCP   7s\n    reviews-v3    ClusterIP   10.96.125.224    <none>        9080/TCP   7s\n```\n\nNow, let's apply traffic-split CRD from SMI :\n\n```sh\napiVersion: split.smi-spec.io/v1alpha1\nkind: TrafficSplit\nmetadata:\n  name: reviews-split\nspec:\n  service: reviews\n  backends:\n    - service: reviews-v1\n      weight: 500m\n    - service: reviews-v2\n      weight: 500m\n```\n\nThis tells Linkerd’s control plane that whenever there are requests to the reviews service, to split them across the `reviews-v1` and `reviews-v2` based on the weights provided.\n\nIf we now go back to our product page, we can only see the reviews with orange or no stars appear on each refresh.\n\n<h2 className=\"chapter-sub-heading\"> Cleanup</h2>\n\n```sh\nkubectl delete trafficsplit/reviews-split\nkubectl delete -f ./sample/service.yaml\n```\n\n- Remove the bookinfo application from the `Meshery Dashboard` by clicking on the `trash icon` in the `sample application` card on the linkerd adapters' page.\n\n</ChapterStyle>\n","frontmatter":{"chapterTitle":"Traffic Splitting using SMI and Linkerd","description":"Meshery is the cloud native management plane which offers lifecycle, configuration, and performance management of service meshes and their workloads."},"fields":{"slug":"learn/learning-paths/mastering-service-meshes-for-developers/introduction-to-service-meshes/linkerd/traffic-splitting","course":"introduction-to-service-meshes","learnpath":"mastering-service-meshes-for-developers","chapter":"traffic-splitting"}},"course":{"nodes":[{"frontmatter":{"courseTitle":"Introduction to Service Meshes - Hands On","meshesYouLearn":[{"imagepath":{"childImageSharp":null,"extension":"svg","publicURL":"/static/731763d720780a49c2ffdfede8c28f4b/istio.svg"},"name":"Istio"},{"imagepath":{"childImageSharp":null,"extension":"svg","publicURL":"/static/b4f4020971de42f6fb2497075a67f325/linkerd.svg"},"name":"Linkerd"}]},"fields":{"slug":"learn/learning-paths/mastering-service-meshes-for-developers/introduction-to-service-meshes"}}]},"TOC":{"nodes":[{"frontmatter":{"order":8,"chapterTitle":"Circuit Breaking"},"fields":{"section":"istio","chapter":"circuit-breaking"}},{"frontmatter":{"order":9,"chapterTitle":"Conclusion"},"fields":{"section":"istio","chapter":"conclusion"}},{"frontmatter":{"order":2,"chapterTitle":"Deploy a sample application"},"fields":{"section":"istio","chapter":"deploy-an-application"}},{"frontmatter":{"order":3,"chapterTitle":"Exposing services through Istio Ingress Gateway"},"fields":{"section":"istio","chapter":"expose-services"}},{"frontmatter":{"order":6,"chapterTitle":"Fault Injection"},"fields":{"section":"istio","chapter":"fault-injection"}},{"frontmatter":{"order":1,"chapterTitle":"Getting Started"},"fields":{"section":"istio","chapter":"getting-started"}},{"frontmatter":{"order":7,"chapterTitle":"Mutual TLS & Identity Verification"},"fields":{"section":"istio","chapter":"mutual-tls"}},{"frontmatter":{"order":4,"chapterTitle":"Observability"},"fields":{"section":"istio","chapter":"observability"}},{"frontmatter":{"order":5,"chapterTitle":"Request Routing and Canary Testing"},"fields":{"section":"istio","chapter":"routing-and-canary"}},{"frontmatter":{"order":9,"chapterTitle":"Conclusion"},"fields":{"section":"linkerd","chapter":"conclusion"}},{"frontmatter":{"order":4,"chapterTitle":"Linkerd Dashboard"},"fields":{"section":"linkerd","chapter":"dashboard"}},{"frontmatter":{"order":5,"chapterTitle":"Debugging (Optional)"},"fields":{"section":"linkerd","chapter":"debugging"}},{"frontmatter":{"order":2,"chapterTitle":"Deploy a sample application"},"fields":{"section":"linkerd","chapter":"deploy-an-application"}},{"frontmatter":{"order":3,"chapterTitle":"Exposing services through Linkerd Ingress"},"fields":{"section":"linkerd","chapter":"expose-services"}},{"frontmatter":{"order":8,"chapterTitle":"Fault Injection"},"fields":{"section":"linkerd","chapter":"fault-injection"}},{"frontmatter":{"order":1,"chapterTitle":"Getting Started"},"fields":{"section":"linkerd","chapter":"getting-started"}},{"frontmatter":{"order":6,"chapterTitle":"Observability"},"fields":{"section":"linkerd","chapter":"observability"}},{"frontmatter":{"order":7,"chapterTitle":"Traffic Splitting using SMI and Linkerd"},"fields":{"section":"linkerd","chapter":"traffic-splitting"}}]},"serviceMeshesList":{"nodes":[{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}}]}},"pageContext":{"learnpath":"mastering-service-meshes-for-developers","slug":"learn/learning-paths/mastering-service-meshes-for-developers/introduction-to-service-meshes/linkerd/traffic-splitting","course":"introduction-to-service-meshes","section":"linkerd","chapter":"traffic-splitting","pageType":"chapter","frontmatter":{"docType":"Chapter","chapterTitle":"Traffic Splitting using SMI and Linkerd","description":"Meshery is the cloud native management plane which offers lifecycle, configuration, and performance management of service meshes and their workloads.","videos":4,"lectures":12,"order":7}}},"staticQueryHashes":["1376321266","1485533831","2848499768","4047814605","961506260"],"matchPath":"/learn/learning-paths/mastering-service-meshes-for-developers/introduction-to-service-meshes/linkerd/traffic-splitting.html"}