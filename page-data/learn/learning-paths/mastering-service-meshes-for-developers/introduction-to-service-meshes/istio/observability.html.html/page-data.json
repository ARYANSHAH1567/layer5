{"componentChunkName":"component---src-templates-learn-chapter-js-content-file-path-home-runner-work-layer-5-layer-5-content-learn-mastering-service-meshes-for-developers-introduction-to-service-meshes-istio-observability-mdx","path":"/learn/learning-paths/mastering-service-meshes-for-developers/introduction-to-service-meshes/istio/observability.html.html","result":{"data":{"chapter":{"body":"\n\nimport ImageAppIcon from \"../../../../src/assets/images/learn-layer5/istio/istio-addons.webp\";\nimport GraffanaDash from \"../../../../src/assets/images/learn-layer5/istio/Grafana_Istio_Dashboard.webp\";\nimport Prometheus from \"../../../../src/assets/images/learn-layer5/istio/Prometheus.webp\";\nimport Jaeger from \"../../../../src/assets/images/learn-layer5/istio/jaeger.webp\";\n\n<ChapterStyle>\n\n<h2 className=\"chapter-sub-heading\">Install Telemetry Add-ons</h2>\n\nUsing Meshery, install Istio telemetry add-ons. In the Istio management page:\n\n1. Click the (+) icon on the `Apply Service Mesh Configuration` card.\n1. Select each of the following add-ons:\n   1. [Prometheus](https://prometheus.io/)\n   1. [Grafana](https://grafana.com/)\n   1. [Jaeger](https://www.jaegertracing.io/)\n\n<a href={ImageAppIcon}>\n  <img src={ImageAppIcon} width=\"100%\" align=\"center\" />\n</a>\n\nYou will use Prometheus and Grafana for collecting and viewing metrics and [Jaeger](https://www.jaegertracing.io/) collecting and viewing distributed traces. Expose each add-on external to the cluster. Each the service network typs are set to \"LoadBalancer\".\n\n<h3 className=\"chapter-sub-heading\">Service Mesh Performance and Telemetry</h3>\n\nMany of the labs require load to be placed on the sample apps. Let's generate HTTP traffic against the BookInfo application, so we can see interesting telemetry.\n\nVerify access through the Ingress Gateway:\n\n```sh\nkubectl get service istio-ingressgateway -n istio-system\n```\n\nOnce we have the port, we can append the IP of one of the nodes to get the host.\n\nThe URL to run a load test against will be `http://<IP/hostname of any of the nodes in the cluster>:<ingress port>/productpage`\n\n**Please note:** If you are using Docker Desktop, please use the IP address of your host. You can leave the port blank. For example: `http://1.2.3.4/productpage`. Managed kubernetes service users will need to use `http://<external-ip of istio-ingressgateway>/productpage` as done in expose services section.\n\nUse the computed URL above in Meshery, in the browser, to run a load test and see the results.\n\n<h4 className=\"chapter-sub-heading\">\n  Connect Grafana (optionally, Prometheus) to Meshery.\n</h4>\n\nOn the Settings page:\n\n1. Navigate to the `Metrics` tab.\n1. Enter Grafana's URL:port number and submit.\n\n<h4 className=\"chapter-sub-heading\">\n  Use Meshery to generate load and analyze performance.\n</h4>\n\nOn the Performance page:\n\n1. give this load test a memorable name\n1. enter the URL to the BookInfo productpage\n1. select `Istio` in the `Service Mesh` dropdown\n1. enter a valid number for `Concurrent requests`\n1. enter a valid number for `Queries per second`\n1. enter a valid `Duration` (a number followed by `s` for seconds (OR) `m` for minutes (OR) `h` for hour)\n1. use the host IP address in the request Tab and in the advanced options, type in the header as `Host:<app-name>`\n\nClick on `Run Test`. A performance test will run and statistical analysis performed. Examine the results of the test and behavior of the service mesh.\n\nNext, you will begin controlling requests to BookInfo using traffic management features.\n\n<br />\n<h3>Alternative: Manual installation</h3>\nFollow these steps if the above steps did not work\n<br />\n<br />\n\n<h4 className=\"chapter-alt-heading\"> Install Add-ons:</h4>\n<br />\n\n**Prometheus**\n\n```sh\nkubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.7/samples/addons/prometheus.yaml\n\n```\n\n**Grafana**\n\n```sh\nkubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.7/samples/addons/grafana.yaml\n\n```\n\n**Jaeger**\n\n```sh\nkubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.7/samples/addons/jaeger.yaml\n\n```\n\n<h4 className=\"chapter-alt-heading\"> Exposing services</h4>\n\nIstio add-on services are deployed by default as `ClusterIP` type services. We can expose the services outside the cluster by either changing the Kubernetes service type to `NodePort` or `LoadBalancer` or by port-forwarding or by configuring Kubernetes Ingress.\n\n**Option 1: Expose services with NodePort**\nTo expose them using NodePort service type, we can edit the services and change the service type from `ClusterIP` to `NodePort`\n\n**Option 2: Expose services with port-forwarding**\nPort-forwarding runs in the foreground. We have appeneded `&` to the end of the above 2 commands to run them in the background. If you donot want this behavior, please remove the `&` from the end.\n\n<h4 className=\"chapter-alt-heading\"> Prometheus</h4>\n\nYou will need to expose the Prometheus service on a port either of the two following methods:\n\n**Option 1: Expose services with NodePort**\n\n```sh\nkubectl -n istio-system edit svc prometheus\n```\n\nTo find the assigned ports for Prometheus:\n\n```sh\nkubectl -n istio-system get svc prometheus\n```\n\n**Option 2: Expose Prometheus service with port-forwarding:**\n\\*\\*\nExpose Prometheus service with port-forwarding:\n\n```sh\nkubectl -n istio-system port-forward \\\n  $(kubectl -n istio-system get pod -l app=prometheus -o jsonpath='{.items[0].metadata.name}') \\\n  9090:9090 &\n```\n\nBrowse to `http://<ip>:<port>` and in the `Expression` input box enter: `istio_request_bytes_count`. Click the Execute button.\n\n<br />\n<img src={Prometheus} align=\"center\" width=\"100%\" />\n\n<br />\n<br />\n<h4 className=\"chapter-alt-heading\"> Grafana</h4>\n\nYou will need to expose the Grafana service on a port either of the two following methods:\n\n```sh\nkubectl -n istio-system edit svc grafana\n```\n\nOnce this is done the services will be assigned dedicated ports on the hosts.\n\nTo find the assigned ports for Grafana:\n\n```sh\nkubectl -n istio-system get svc grafana\n```\n\n**Expose Grafana service with port-forwarding:**\n\n```sh\nkubectl -n istio-system port-forward $(kubectl -n istio-system get pod -l app=grafana \\\n  -o jsonpath='{.items[0].metadata.name}') 3000:3000 &\n```\n\n<img src={GraffanaDash} align=\"center\" width=\"100%\" />\n\n<br />\n<br />\n<h4 className=\"chapter-alt-heading\"> Distributed Tracing</h4>\n\nThe sample Bookinfo application is configured to collect trace spans using Zipkin or Jaeger. Although Istio proxies are able to automatically send spans, it needs help from the application to tie together the entire trace. To do this applications need to propagate the appropriate HTTP headers so that when the proxies send span information to Zipkin or Jaeger, the spans can be correlated correctly into a single trace.\n\nTo do this the application collects and propagates the following headers from the incoming request to any outgoing requests:\n\n- `x-request-id`\n- `x-b3-traceid`\n- `x-b3-spanid`\n- `x-b3-parentspanid`\n- `x-b3-sampled`\n- `x-b3-flags`\n- `x-ot-span-context`\n\n<br />\n\n<a href={Jaeger}>\n  <img src={Jaeger} width=\"100%\" align=\"center\" />\n</a>\n\n<br />\n<br />\n\n<h4 className=\"chapter-alt-heading\"> Exposing services</h4>\n\nIstio add-on services are deployed by default as `ClusterIP` type services. We can expose the services outside the cluster by either changing the Kubernetes service type to `NodePort` or `LoadBalancer` or by port-forwarding or by configuring Kubernetes Ingress. In this lab, we will briefly demonstrate the `NodePort` and port-forwarding ways of exposing services.\n\n<h5 className=\"chapter-alt-heading\"> Option 1: Expose services with NodePort</h5>\n\nTo expose them using NodePort service type, we can edit the services and change the service type from `ClusterIP` to `NodePort`\n\nFor Jaeger, either of `tracing` or `jaeger-query` can be exposed.\n\n```sh\nkubectl -n istio-system edit svc tracing\n```\n\nOnce this is done the services will be assigned dedicated ports on the hosts.\n\nTo find the assigned ports for Jaeger:\n\n```sh\nkubectl -n istio-system get svc tracing\n```\n\n<h5 className=\"chapter-alt-heading\">\n  Option 2: Expose services with port-forwarding\n</h5>\n\nTo port-forward Jaeger:\n\n```sh\nkubectl -n istio-system port-forward \\\n  $(kubectl -n istio-system get pod -l app=jaeger -o jsonpath='{.items[0].metadata.name}') \\\n  16686:16686 &\n```\n\n<h4 className=\"chapter-alt-heading\"> View Traces</h4>\n\nLet us find the port Jaeger is exposed on by running the following command:\n\n```sh\nkubectl -n istio-system get svc tracing\n```\n\nYou can click on the link at the top of the page which maps to the right port and it will open Jaeger UI in a new tab.\n\n</ChapterStyle>\n","frontmatter":{"chapterTitle":"Observability","description":"Meshery is the cloud native management plane which offers lifecycle, configuration, and performance management of service meshes and their workloads."},"fields":{"slug":"learn/learning-paths/mastering-service-meshes-for-developers/introduction-to-service-meshes/istio/observability","course":"introduction-to-service-meshes","learnpath":"mastering-service-meshes-for-developers","chapter":"observability"}},"course":{"nodes":[{"frontmatter":{"courseTitle":"Introduction to Service Meshes - Hands On","meshesYouLearn":[{"imagepath":{"childImageSharp":null,"extension":"svg","publicURL":"/static/731763d720780a49c2ffdfede8c28f4b/istio.svg"},"name":"Istio"},{"imagepath":{"childImageSharp":null,"extension":"svg","publicURL":"/static/b4f4020971de42f6fb2497075a67f325/linkerd.svg"},"name":"Linkerd"}]},"fields":{"slug":"learn/learning-paths/mastering-service-meshes-for-developers/introduction-to-service-meshes"}}]},"TOC":{"nodes":[{"frontmatter":{"order":8,"chapterTitle":"Circuit Breaking"},"fields":{"section":"istio","chapter":"circuit-breaking"}},{"frontmatter":{"order":9,"chapterTitle":"Conclusion"},"fields":{"section":"istio","chapter":"conclusion"}},{"frontmatter":{"order":2,"chapterTitle":"Deploy a sample application"},"fields":{"section":"istio","chapter":"deploy-an-application"}},{"frontmatter":{"order":3,"chapterTitle":"Exposing services through Istio Ingress Gateway"},"fields":{"section":"istio","chapter":"expose-services"}},{"frontmatter":{"order":6,"chapterTitle":"Fault Injection"},"fields":{"section":"istio","chapter":"fault-injection"}},{"frontmatter":{"order":1,"chapterTitle":"Getting Started"},"fields":{"section":"istio","chapter":"getting-started"}},{"frontmatter":{"order":7,"chapterTitle":"Mutual TLS & Identity Verification"},"fields":{"section":"istio","chapter":"mutual-tls"}},{"frontmatter":{"order":4,"chapterTitle":"Observability"},"fields":{"section":"istio","chapter":"observability"}},{"frontmatter":{"order":5,"chapterTitle":"Request Routing and Canary Testing"},"fields":{"section":"istio","chapter":"routing-and-canary"}},{"frontmatter":{"order":9,"chapterTitle":"Conclusion"},"fields":{"section":"linkerd","chapter":"conclusion"}},{"frontmatter":{"order":4,"chapterTitle":"Linkerd Dashboard"},"fields":{"section":"linkerd","chapter":"dashboard"}},{"frontmatter":{"order":5,"chapterTitle":"Debugging (Optional)"},"fields":{"section":"linkerd","chapter":"debugging"}},{"frontmatter":{"order":2,"chapterTitle":"Deploy a sample application"},"fields":{"section":"linkerd","chapter":"deploy-an-application"}},{"frontmatter":{"order":3,"chapterTitle":"Exposing services through Linkerd Ingress"},"fields":{"section":"linkerd","chapter":"expose-services"}},{"frontmatter":{"order":8,"chapterTitle":"Fault Injection"},"fields":{"section":"linkerd","chapter":"fault-injection"}},{"frontmatter":{"order":1,"chapterTitle":"Getting Started"},"fields":{"section":"linkerd","chapter":"getting-started"}},{"frontmatter":{"order":6,"chapterTitle":"Observability"},"fields":{"section":"linkerd","chapter":"observability"}},{"frontmatter":{"order":7,"chapterTitle":"Traffic Splitting using SMI and Linkerd"},"fields":{"section":"linkerd","chapter":"traffic-splitting"}}]},"serviceMeshesList":{"nodes":[{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}}]}},"pageContext":{"learnpath":"mastering-service-meshes-for-developers","slug":"learn/learning-paths/mastering-service-meshes-for-developers/introduction-to-service-meshes/istio/observability","course":"introduction-to-service-meshes","section":"istio","chapter":"observability","pageType":"chapter","frontmatter":{"docType":"Chapter","chapterTitle":"Observability","description":"Meshery is the cloud native management plane which offers lifecycle, configuration, and performance management of service meshes and their workloads.","videos":4,"lectures":12,"order":4}}},"staticQueryHashes":["1376321266","1485533831","2848499768","4047814605","961506260"],"matchPath":"/learn/learning-paths/mastering-service-meshes-for-developers/introduction-to-service-meshes/istio/observability.html"}