{"componentChunkName":"component---src-templates-learn-chapter-js-content-file-path-home-runner-work-layer-5-layer-5-content-learn-mastering-service-meshes-for-developers-introduction-to-service-meshes-istio-fault-injection-mdx","path":"/learn/learning-paths/mastering-service-meshes-for-developers/introduction-to-service-meshes/istio/fault-injection.html.html","result":{"data":{"chapter":{"body":"\n\n\n<ChapterStyle>\n\nIn this chapter we will learn how to test the resiliency of an application by injecting systematic faults.\nBefore we start, we will need to reset the virtual services.\n\nUsing Meshery, navigate to the Istio management page:\n\n1. Enter `default` in the `Namespace` field.\n2. Click the (+) icon on the `Apply Custom Configuration` card and paste the configuration below.\n\nConfig:\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: reviews\nspec:\n  hosts:\n    - reviews\n  http:\n    - route:\n        - destination:\n            host: reviews\n            subset: v2\n```\n\n<h2 className=\"chapter-sub-heading\">\n  Inject a route rule to create a fault using HTTP delay\n</h2>\n\nTo start, we will inject a 7s delay for accessing the ratings service for a user `jason`. reviews v2 service has a 10s hard-coded connection timeout for its calls to the ratings service configured globally.\n\nUsing Meshery, navigate to the Istio management page:\n\n1. Enter `default` in the `Namespace` field.\n2. Click the (+) icon on the `Apply Custom Configuration` card and paste the configuration below.\n\nThis will update the existing virtual service definition for ratings to inject a delay for user `jason` to access the ratings V1.\n\nIn a few, we should be able to verify the virtual service by using the command below:\n\n```sh\nkubectl get virtualservice ratings -o yaml\n```\n\nConfig:\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: ratings\nspec:\n  hosts:\n    - ratings\n  http:\n    - fault:\n        delay:\n          fixedDelay: 7s\n          percentage:\n            value: 100\n      match:\n        - headers:\n            end-user:\n              exact: jason\n      route:\n        - destination:\n            host: ratings\n            subset: v1\n    - route:\n        - destination:\n            host: ratings\n            subset: v1\n```\n\nNow we login to `/productpage` as user `jason` and observe that the page loads but because of the induced delay between services the reviews section will show :\n\n<b>Error fetching product reviews!</b>\nSorry, product reviews are currently unavailable for this book.\n\nIf you logout or login as a different user, the page should load normally without any errors.\n\n<h2 className=\"chapter-sub-heading\">\n  Inject a route rule to create a fault using HTTP abort\n</h2>\n\nIn this section, , we will introduce an HTTP abort to the ratings microservices for user `jason`.\n\nUsing Meshery, navigate to the Istio management page:\n\n1. Enter `default` in the `Namespace` field.\n2. Click the (+) icon on the `Apply Custom Configuration` card and paste the configuration below.\n\nThis will update the existing virtual service definition for ratings to inject a HTTP abort for user `jason` to access the ratings V1.\n\nIn a few, we should be able to verify the virtual service by using the command below:\n\n```sh\nkubectl get virtualservice ratings -o yaml\n```\n\nConfig:\n\n```yaml\napiVersion: networking.istio.io/v1alpha3\nkind: VirtualService\nmetadata:\n  name: ratings\nspec:\n  hosts:\n    - ratings\n  http:\n    - fault:\n        abort:\n          httpStatus: 500\n          percentage:\n            value: 100\n      match:\n        - headers:\n            end-user:\n              exact: jason\n      route:\n        - destination:\n            host: ratings\n            subset: v1\n    - route:\n        - destination:\n            host: ratings\n            subset: v1\n```\n\nNow we login to `/productpage` as user `jason` and observe that the page loads without any new delays but because of the induced fault between services the reviews section will show:\n\n`Ratings service is currently unavailable`.\n\n<h3 className=\"chapter-sub-heading\"> Verify fault injection</h3>\n\nVerify the fault injection by logging out (or logging in as a different user), the page should load normally without any errors.\n\n<br />\n<h3>Alternative: Manual installation</h3>\nFollow these steps if the above steps did not work\n<br />\n<br />\n\n<h4 className=\"chapter-alt-heading\">\n  Route all traffic to version V1 of all services\n</h4>\n\n```sh\nkubectl apply -f samples/bookinfo/networking/virtual-service-all-v1.yaml\n```\n\n<h4 className=\"chapter-alt-heading\">\n  Route all traffic to version V2 of reviews for user Jason\n</h4>\n\n```sh\nkubectl apply -f samples/bookinfo/networking/virtual-service-reviews-test-v2.yaml\n```\n\n<h4 className=\"chapter-alt-heading\"> Inject 7s delay for ratings service</h4>\n\n```sh\nkubectl apply -f samples/bookinfo/networking/virtual-service-ratings-test-delay.yaml\n```\n\n<h4 className=\"chapter-alt-heading\"> Inject HTTP abort for ratings service</h4>\n\n```sh\nkubectl apply -f samples/bookinfo/networking/virtual-service-ratings-test-abort.yaml\n```\n\n</ChapterStyle>\n","frontmatter":{"chapterTitle":"Fault Injection","description":"Meshery is the cloud native management plane which offers lifecycle, configuration, and performance management of service meshes and their workloads."},"fields":{"slug":"learn/learning-paths/mastering-service-meshes-for-developers/introduction-to-service-meshes/istio/fault-injection","course":"introduction-to-service-meshes","learnpath":"mastering-service-meshes-for-developers","chapter":"fault-injection"}},"course":{"nodes":[{"frontmatter":{"courseTitle":"Introduction to Service Meshes - Hands On","meshesYouLearn":[{"imagepath":{"childImageSharp":null,"extension":"svg","publicURL":"/static/731763d720780a49c2ffdfede8c28f4b/istio.svg"},"name":"Istio"},{"imagepath":{"childImageSharp":null,"extension":"svg","publicURL":"/static/b4f4020971de42f6fb2497075a67f325/linkerd.svg"},"name":"Linkerd"}]},"fields":{"slug":"learn/learning-paths/mastering-service-meshes-for-developers/introduction-to-service-meshes"}}]},"TOC":{"nodes":[{"frontmatter":{"order":8,"chapterTitle":"Circuit Breaking"},"fields":{"section":"istio","chapter":"circuit-breaking"}},{"frontmatter":{"order":9,"chapterTitle":"Conclusion"},"fields":{"section":"istio","chapter":"conclusion"}},{"frontmatter":{"order":2,"chapterTitle":"Deploy a sample application"},"fields":{"section":"istio","chapter":"deploy-an-application"}},{"frontmatter":{"order":3,"chapterTitle":"Exposing services through Istio Ingress Gateway"},"fields":{"section":"istio","chapter":"expose-services"}},{"frontmatter":{"order":6,"chapterTitle":"Fault Injection"},"fields":{"section":"istio","chapter":"fault-injection"}},{"frontmatter":{"order":1,"chapterTitle":"Getting Started"},"fields":{"section":"istio","chapter":"getting-started"}},{"frontmatter":{"order":7,"chapterTitle":"Mutual TLS & Identity Verification"},"fields":{"section":"istio","chapter":"mutual-tls"}},{"frontmatter":{"order":4,"chapterTitle":"Observability"},"fields":{"section":"istio","chapter":"observability"}},{"frontmatter":{"order":5,"chapterTitle":"Request Routing and Canary Testing"},"fields":{"section":"istio","chapter":"routing-and-canary"}},{"frontmatter":{"order":9,"chapterTitle":"Conclusion"},"fields":{"section":"linkerd","chapter":"conclusion"}},{"frontmatter":{"order":4,"chapterTitle":"Linkerd Dashboard"},"fields":{"section":"linkerd","chapter":"dashboard"}},{"frontmatter":{"order":5,"chapterTitle":"Debugging (Optional)"},"fields":{"section":"linkerd","chapter":"debugging"}},{"frontmatter":{"order":2,"chapterTitle":"Deploy a sample application"},"fields":{"section":"linkerd","chapter":"deploy-an-application"}},{"frontmatter":{"order":3,"chapterTitle":"Exposing services through Linkerd Ingress"},"fields":{"section":"linkerd","chapter":"expose-services"}},{"frontmatter":{"order":8,"chapterTitle":"Fault Injection"},"fields":{"section":"linkerd","chapter":"fault-injection"}},{"frontmatter":{"order":1,"chapterTitle":"Getting Started"},"fields":{"section":"linkerd","chapter":"getting-started"}},{"frontmatter":{"order":6,"chapterTitle":"Observability"},"fields":{"section":"linkerd","chapter":"observability"}},{"frontmatter":{"order":7,"chapterTitle":"Traffic Splitting using SMI and Linkerd"},"fields":{"section":"linkerd","chapter":"traffic-splitting"}}]},"serviceMeshesList":{"nodes":[{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}},{"fields":{"section":"linkerd"}}]}},"pageContext":{"learnpath":"mastering-service-meshes-for-developers","slug":"learn/learning-paths/mastering-service-meshes-for-developers/introduction-to-service-meshes/istio/fault-injection","course":"introduction-to-service-meshes","section":"istio","chapter":"fault-injection","pageType":"chapter","frontmatter":{"docType":"Chapter","chapterTitle":"Fault Injection","description":"Meshery is the cloud native management plane which offers lifecycle, configuration, and performance management of service meshes and their workloads.","videos":4,"lectures":12,"order":6}}},"staticQueryHashes":["1376321266","1485533831","2848499768","4047814605","961506260"],"matchPath":"/learn/learning-paths/mastering-service-meshes-for-developers/introduction-to-service-meshes/istio/fault-injection.html"}